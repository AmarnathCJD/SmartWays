<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Emergency Vehicle Control</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #121212;
            --bg-card: #1E1E1E;
            --bg-input: #2D2D2D;
            --red-500: #ef4444;
            --red-600: #dc2626;
            --green-500: #22c55e;
            --yellow-500: #eab308;
            --text-white: #ffffff;
            --text-gray: #888888;
            --border-dark: #333333;
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background-image: linear-gradient(rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0.75)),
                url('https://images.unsplash.com/photo-1573108724029-4c46571d6490?auto=format&fit=crop&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text-white);
            min-height: 100vh;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .card {
            background-color: var(--bg-card);
            border-radius: 1.25rem;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding-bottom: 1.25rem;
            border-bottom: 1px solid var(--border-dark);
        }

        .card-title {
            color: var(--red-500);
            font-size: 1.1rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .status-indicator {
            font-size: 0.875rem;
            color: var(--green-500);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(34, 197, 94, 0.1);
            border-radius: 2rem;
        }

        .form-group {
            margin-bottom: 1.75rem;
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
            color: var(--text-gray);
        }

        .form-select {
            width: 100%;
            background-color: var(--bg-input);
            border: 1px solid var(--border-dark);
            border-radius: 0.75rem;
            padding: 1rem;
            color: var(--text-white);
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .form-input {
            width: 91.5%;
            background-color: var(--bg-input);
            border: 1px solid var(--border-dark);
            border-radius: 0.75rem;
            padding: 1rem;
            color: var(--text-white);
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .form-select:focus,
        .form-input:focus {
            outline: none;
            border-color: var(--red-500);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
        }

        .radio-group {
            display: flex;
            gap: 1rem;
            margin-top: 0.75rem;
        }

        .radio-label {
            flex: 1;
            position: relative;
            padding: 0.75rem;
            background-color: var(--bg-input);
            border: 1px solid var(--border-dark);
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .radio-label:hover {
            background-color: rgba(239, 68, 68, 0.1);
        }

        .radio-label input {
            position: absolute;
            opacity: 0;
        }

        .radio-text {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-gray);
        }

        .radio-label input:checked+.radio-text {
            color: var(--red-500);
            font-weight: 500;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.75rem;
            background-color: var(--bg-input);
            border-radius: 0.75rem;
            transition: all 0.2s;
        }

        .toggle-container:hover {
            background-color: rgba(239, 68, 68, 0.1);
        }

        .toggle-slider {
            position: relative;
            width: 3rem;
            height: 1.5rem;
            background-color: var(--border-dark);
            border-radius: 1rem;
            transition: all 0.2s;
        }

        .toggle-slider:before {
            content: '';
            position: absolute;
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 50%;
            background-color: var(--text-gray);
            top: 0.125rem;
            left: 0.125rem;
            transition: all 0.2s;
        }

        .toggle-container input {
            display: none;
        }

        .toggle-container input:checked+.toggle-slider {
            background-color: var(--red-500);
        }

        .toggle-container input:checked+.toggle-slider:before {
            transform: translateX(1.5rem);
            background-color: white;
        }

        .toggle-label {
            font-size: 0.875rem;
            color: var(--text-gray);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn {
            width: 100%;
            background-color: var(--red-500);
            color: var(--text-white);
            border: none;
            border-radius: 0.75rem;
            padding: 1rem;
            font-weight: 500;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .btn:hover {
            background-color: var(--red-600);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.25);
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            z-index: 1000;
        }

        .modal {
            background-color: var(--bg-card);
            border-radius: 1.25rem;
            width: 100%;
            max-width: 400px;
            animation: slideIn 0.3s ease-out;
        }

        .modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-dark);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 1.25rem;
            color: var(--red-500);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-gray);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-white);
        }

        .modal-content {
            padding: 2rem;
        }

        .alert-status {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: rgba(239, 68, 68, 0.1);
            border-radius: 0.75rem;
        }

        .status-dot {
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            background-color: var(--red-500);
            animation: pulse 2s infinite;
        }

        .alert-details {
            background-color: var(--bg-input);
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin: 1.5rem 0;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
        }

        .detail-item:not(:last-child) {
            border-bottom: 1px solid var(--border-dark);
        }

        .detail-label {
            color: var(--text-gray);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .alert-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn-stop {
            background-color: var(--yellow-500);
        }

        .btn-stop:hover {
            box-shadow: 0 4px 12px rgba(234, 179, 8, 0.25);
        }

        .btn-cancel {
            background-color: var(--red-500);
        }

        .btn-cancel:hover {
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.25);
        }

        .active-alerts {
            margin-top: 1.5rem;
        }

        .alert-card {
            background-color: var(--bg-card);
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideIn 0.3s ease-out;
        }

        .material-icons-round {
            font-size: 1.25rem;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-1rem);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 1rem;
            }

            .card {
                padding: 1.5rem;
            }

            .radio-group {
                flex-direction: column;
                gap: 0.75rem;
            }

            .radio-label {
                padding: 1rem;
            }

            .alert-actions {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 1.5rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title"><span class="material-icons-round">warning</span> Emergency Control Center</h2>
                <div class="status-indicator" id="systemStatus">
                    <span class="material-icons-round">radio_button_checked</span>
                    System Ready
                </div>
            </div>

            <form id="emergencyForm">
                <div class="form-group">
                    <label class="form-label">
                        <span class="material-icons-round">local_shipping</span>
                        Emergency Type
                    </label>
                    <select id="emergencyType" class="form-select" required>
                        <option value="ambulance">ðŸš‘ Ambulance</option>
                        <option value="fire">ðŸš’ Fire Truck</option>
                        <option value="police">ðŸš“ Police Vehicle</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span class="material-icons-round">priority_high</span>
                        Severity Level
                    </label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="severity" value="low" required>
                            <span class="radio-text">
                                <span class="material-icons-round">arrow_downward</span>
                                Low
                            </span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="severity" value="medium" checked>
                            <span class="radio-text">
                                <span class="material-icons-round">remove</span>
                                Medium
                            </span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="severity" value="high">
                            <span class="radio-text">
                                <span class="material-icons-round">arrow_upward</span>
                                High
                            </span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span class="material-icons-round">place</span>
                        Destination
                    </label>
                    <input type="text" id="destination" class="form-input" placeholder="Enter destination address"
                        required />
                </div>

                <div class="form-group">
                    <label class="toggle-container">
                        <input type="checkbox" id="requiresClearance">
                        <span class="toggle-slider"></span>
                        <span class="toggle-label">
                            <span class="material-icons-round">verified_user</span>
                            Requires Special Clearance
                        </span>
                    </label>
                </div>

                <button type="submit" class="btn" id="submitBtn">
                    <span class="material-icons-round">notifications_active</span>
                    Trigger Emergency Route
                </button>
            </form>
        </div>

        <div class="active-alerts" id="activeAlerts">
            <!-- Active alerts will be inserted here -->
        </div>
    </div>

    <div id="modalOverlay" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">
                    <span class="material-icons-round">warning</span>
                    Emergency Alert
                </h2>
                <button id="closeModal" class="close-btn">
                    <span class="material-icons-round">close</span>
                </button>
            </div>

            <div class="modal-content">
                <div class="alert-status">
                    <span class="status-dot"></span>
                    <span id="alertStatus">Initializing...</span>
                </div>

                <div class="alert-details">
                    <div class="detail-item">
                        <span class="detail-label">
                            <span class="material-icons-round">local_shipping</span>
                            Type
                        </span>
                        <span id="vehicleTypeDisplay"></span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">
                            <span class="material-icons-round">priority_high</span>
                            Severity
                        </span>
                        <span id="severityDisplay"></span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">
                            <span class="material-icons-round">place</span>
                            Destination
                        </span>
                        <span id="destinationDisplay"></span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">
                            <span class="material-icons-round">verified_user</span>
                            Clearance
                        </span>
                        <span id="clearanceDisplay"></span>
                    </div>
                </div>

                <div class="alert-actions">
                    <button id="stopAlert" class="btn btn-stop">
                        <span class="material-icons-round">pause_circle</span>
                        Stop Alert
                    </button>
                    <button id="cancelAlert" class="btn btn-cancel">
                        <span class="material-icons-round">cancel</span>
                        Cancel Alert
                    </button>
                </div>
            </div>
        </div>
    </div>


    <script>
        let activeID = 0;

        const API_BASE_URL = '/api';
        const API_ENDPOINTS = {
            createAlert: `${API_BASE_URL}/alerts`,
            stopAlert: (id) => `${API_BASE_URL}/delalert`,
            cancelAlert: (id) => `${API_BASE_URL}/alerts/${id}/cancel`,
        };

        let activeAlerts = new Map();

        const elements = {
            form: document.getElementById('emergencyForm'),
            systemStatus: document.getElementById('systemStatus'),
            modalOverlay: document.getElementById('modalOverlay'),
            closeModal: document.getElementById('closeModal'),
            stopAlert: document.getElementById('stopAlert'),
            cancelAlert: document.getElementById('cancelAlert'),
            activeAlertsList: document.getElementById('activeAlerts'),
            vehicleType: document.getElementById('vehicleTypeDisplay'),
            severity: document.getElementById('severityDisplay'),
            destination: document.getElementById('destinationDisplay'),
            clearance: document.getElementById('clearanceDisplay'),
            alertStatus: document.getElementById('alertStatus'),
        };

        elements.form.addEventListener('submit', handleEmergencyAlert);
        elements.closeModal.addEventListener('click', closeModal);
        elements.stopAlert.addEventListener('click', () => handleAlertAction('stop'));
        elements.cancelAlert.addEventListener('click', () => handleAlertAction('cancel'));

        function updateSystemStatus(message, type = 'success') {
            elements.systemStatus.innerHTML = `
        <span class="material-icons-round">radio_button_checked</span>
        ${message}
    `;
            elements.systemStatus.className = `status-indicator status-${type}`;
        }

        function showError(message) {
            updateSystemStatus(message, 'error');
            setTimeout(() => updateSystemStatus('System Ready'), 3000);
        }

        async function formatAlertData(formData) {
            if (!navigator.geolocation) {
                showError('Geolocation is not supported by your browser');
                return null;
            }

            return new Promise((resolve, reject) => {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        resolve({
                            type: document.getElementById('emergencyType').value,
                            severity: formData.get('severity'),
                            destination: document.getElementById('destination').value,
                            location: {
                                latitude: position.coords.latitude,
                                longitude: position.coords.longitude
                            },
                            requiresClearance: document.getElementById('requiresClearance').checked,
                            timestamp: new Date().toISOString()
                        });
                    },
                    (error) => {
                        showError('Failed to get location');
                        reject(error);
                    }
                );
            });
        }


        function getVehicleIcon(type) {
            const icons = {
                ambulance: 'ðŸš‘',
                fire: 'ðŸš’',
                police: 'ðŸš“'
            };
            return icons[type] || 'ðŸš¨';
        }

        function getSeverityIcon(severity) {
            const icons = {
                low: 'arrow_downward',
                medium: 'remove',
                high: 'arrow_upward'
            };
            return icons[severity] || 'priority_high';
        }

        function updateModalDisplay(alertData) {
            elements.vehicleType.textContent = `${getVehicleIcon(alertData.type)} ${alertData.type}`;
            elements.severity.innerHTML = `
        <span class="material-icons-round">${getSeverityIcon(alertData.severity)}</span>
        ${alertData.severity}
    `;
            elements.destination.textContent = alertData.destination;
            elements.clearance.innerHTML = alertData.requiresClearance ?
                '<span class="material-icons-round">verified</span> Required' :
                '<span class="material-icons-round">no_encryption</span> Not Required';
            elements.alertStatus.textContent = 'Active';

            elements.modalOverlay.style.display = 'flex';
        }


        function createAlertCard(alert) {
            const card = document.createElement('div');
            card.className = 'alert-card';
            card.id = `alert-${alert.id}`;

            card.innerHTML = `
        <div class="alert-info">
            <strong>${getVehicleIcon(alert.type)} ${alert.type}</strong> - ${alert.destination}
            <span class="alert-severity severity-${alert.severity}">
                <span class="material-icons-round">${getSeverityIcon(alert.severity)}</span>
                ${alert.severity}
            </span>
        </div>
        <div class="alert-actions">
            <button class="btn btn-stop">Stop</button>
            <button class="btn btn-cancel">Cancel</button>
        </div>
    `;

            const stopButton = card.querySelector('.btn-stop');
            const cancelButton = card.querySelector('.btn-cancel');

            stopButton.addEventListener('click', () => handleAlertAction('stop', alert.id));
            cancelButton.addEventListener('click', () => handleAlertAction('cancel', alert.id));

            elements.activeAlertsList.appendChild(card);
        }


        async function sendRequest(endpoint, method = 'POST', data = null) {
            try {
                const response = await fetch(endpoint, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: data ? JSON.stringify(data) : null,
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        async function handleEmergencyAlert(e) {
            e.preventDefault();

            try {
                updateSystemStatus('Sending alert...');
                const formData = new FormData(e.target);

                const alertData = await formatAlertData(formData);
                if (!alertData) return;

                const response = await sendRequest(API_ENDPOINTS.createAlert, 'POST', alertData);
                activeAlerts.set(response.id, alertData);
                activeID = response.id;

                createAlertCard({ ...alertData, id: response.id });
                updateModalDisplay(alertData);
                elements.modalOverlay.style.display = 'flex';

                updateSystemStatus('Alert sent successfully');
                e.target.reset();
            } catch (error) {
                showError('Failed to send alert');
            }
        }

        async function handleAlertAction(action, alertId) {
            try {
                updateSystemStatus(`Processing ${action}...`);

                const endpoint = API_ENDPOINTS[`${action}Alert`](alertId);
                await sendRequest(endpoint, 'POST');

                activeAlerts.delete(alertId);
                const alertCard = document.getElementById(`alert-${alertId}`);
                if (alertCard) alertCard.remove();

                if (action === 'cancel') closeModal();

                updateSystemStatus(`Alert ${action}ed successfully`);
            } catch (error) {
                showError(`Failed to ${action} alert`);
            }
        }


        function closeModal() {
            elements.modalOverlay.style.display = 'none';
        }
        updateSystemStatus('System Ready');

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && elements.modalOverlay.style.display === 'flex') {
                closeModal();
            }
        });
    </script>
</body>

</html>